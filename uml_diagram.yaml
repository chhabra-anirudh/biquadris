# Biquadris UML Diagram - YAML Representation
# Public methods only (excluding constructors, destructors, accessors, mutators, big 5)

diagram:
  name: "Biquadris Class Diagram"
  type: "UML Class Diagram"
  
classes:
  # Core Game Classes
  - name: "Game"
    module: "Game"
    methods:
      - name: "run"
        return_type: "void"
        visibility: "public"
      - name: "switchPlayer"
        return_type: "void"
        visibility: "public"
      - name: "restart"
        return_type: "void"
        visibility: "public"
      - name: "handleSpecialAction"
        return_type: "void"
        visibility: "public"
    relationships:
      - type: "composition"
        target: "Player"
        multiplicity: "2"
      - type: "composition"
        target: "TextDisplay"
        multiplicity: "1"
      - type: "composition"
        target: "GraphicsDisplay"
        multiplicity: "0..1"
      - type: "composition"
        target: "CommandInterpreter"
        multiplicity: "1"

  - name: "Player"
    module: "Player"
    methods:
      - name: "moveLeft"
        return_type: "bool"
        parameters: ["int n = 1"]
        visibility: "public"
      - name: "moveRight"
        return_type: "bool"
        parameters: ["int n = 1"]
        visibility: "public"
      - name: "moveDown"
        return_type: "bool"
        parameters: ["int n = 1"]
        visibility: "public"
      - name: "rotate"
        return_type: "bool"
        parameters: ["bool clockwise", "int multiplier = 1"]
        visibility: "public"
      - name: "drop"
        return_type: "void"
        parameters: ["int multiplier = 1"]
        visibility: "public"
      - name: "levelUp"
        return_type: "void"
        parameters: ["int multiplier = 1"]
        visibility: "public"
      - name: "levelDown"
        return_type: "void"
        parameters: ["int multiplier = 1"]
        visibility: "public"
      - name: "setLevel"
        return_type: "void"
        parameters: ["int newLevel"]
        visibility: "public"
      - name: "setNoRandom"
        return_type: "void"
        parameters: ["const string& file"]
        visibility: "public"
      - name: "setRandom"
        return_type: "void"
        visibility: "public"
      - name: "applySpecialAction"
        return_type: "void"
        parameters: ["SpecialAction* action"]
        visibility: "public"
      - name: "setBlind"
        return_type: "void"
        parameters: ["bool blind"]
        visibility: "public"
      - name: "incrementHeavyEffect"
        return_type: "void"
        visibility: "public"
      - name: "forceBlock"
        return_type: "void"
        parameters: ["char type"]
        visibility: "public"
      - name: "replaceBlock"
        return_type: "void"
        parameters: ["char type"]
        visibility: "public"
      - name: "isGameOver"
        return_type: "bool"
        visibility: "public"
        const: true
      - name: "reset"
        return_type: "void"
        visibility: "public"
    relationships:
      - type: "composition"
        target: "Board"
        multiplicity: "1"
      - type: "composition"
        target: "Block"
        multiplicity: "*"
      - type: "composition"
        target: "Level"
        multiplicity: "1"
      - type: "dependency"
        target: "SpecialAction"

  - name: "Board"
    module: "Board"
    parent: "Subject"
    methods:
      - name: "placeBlock"
        return_type: "bool"
        parameters: ["Block* block"]
        visibility: "public"
      - name: "canPlace"
        return_type: "bool"
        parameters: ["Block* block", "int row", "int col"]
        visibility: "public"
        const: true
      - name: "canPlaceAtPositions"
        return_type: "bool"
        parameters: ["const vector<Position>& positions"]
        visibility: "public"
        const: true
      - name: "removeBlock"
        return_type: "void"
        parameters: ["Block* block"]
        visibility: "public"
      - name: "clearFullRows"
        return_type: "int"
        visibility: "public"
      - name: "isRowFull"
        return_type: "bool"
        parameters: ["int row"]
        visibility: "public"
        const: true
      - name: "clearRow"
        return_type: "void"
        parameters: ["int row"]
        visibility: "public"
      - name: "dropRowsAbove"
        return_type: "void"
        parameters: ["int clearedRow"]
        visibility: "public"
      - name: "createStarBlock"
        return_type: "Block*"
        visibility: "public"
    relationships:
      - type: "composition"
        target: "Cell"
        multiplicity: "*"
      - type: "aggregation"
        target: "Block"
        multiplicity: "*"
      - type: "dependency"
        target: "Position"
      - type: "inheritance"
        target: "Subject"

  - name: "Block"
    module: "Block"
    abstract: true
    methods:
      - name: "setPosition"
        return_type: "void"
        parameters: ["const Position& pos"]
        visibility: "public"
      - name: "getCurrentPositions"
        return_type: "vector<Position>"
        visibility: "public"
        const: true
      - name: "rotateClockwise"
        return_type: "void"
        visibility: "public"
      - name: "rotateCounterClockwise"
        return_type: "void"
        visibility: "public"
      - name: "addCell"
        return_type: "void"
        parameters: ["Cell* cell"]
        visibility: "public"
      - name: "removeCell"
        return_type: "void"
        parameters: ["Cell* cell"]
        visibility: "public"
      - name: "isFilled"
        return_type: "bool"
        visibility: "public"
      - name: "decrementCell"
        return_type: "void"
        visibility: "public"
    relationships:
      - type: "aggregation"
        target: "Cell"
        multiplicity: "*"
      - type: "dependency"
        target: "Position"

  # Block Subclasses
  - name: "IBlock"
    module: "IBlock"
    parent: "Block"
    methods: []

  - name: "JBlock"
    module: "JBlock"
    parent: "Block"
    methods: []

  - name: "LBlock"
    module: "LBlock"
    parent: "Block"
    methods: []

  - name: "OBlock"
    module: "OBlock"
    parent: "Block"
    methods: []

  - name: "SBlock"
    module: "SBlock"
    parent: "Block"
    methods: []

  - name: "ZBlock"
    module: "ZBlock"
    parent: "Block"
    methods: []

  - name: "TBlock"
    module: "TBlock"
    parent: "Block"
    methods: []

  - name: "StarBlock"
    module: "StarBlock"
    parent: "Block"
    methods: []

  # Level Classes
  - name: "Level"
    module: "Level"
    abstract: true
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        pure_virtual: true
      - name: "setRandom"
        return_type: "void"
        parameters: ["bool random"]
        visibility: "public"
        virtual: true
      - name: "setSequenceFile"
        return_type: "void"
        parameters: ["const string& filename"]
        visibility: "public"
    relationships:
      - type: "dependency"
        target: "Block"

  - name: "Level0"
    module: "Level0"
    parent: "Level"
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        override: true

  - name: "Level1"
    module: "Level1"
    parent: "Level"
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        override: true

  - name: "Level2"
    module: "Level2"
    parent: "Level"
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        override: true

  - name: "Level3"
    module: "Level3"
    parent: "Level"
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        override: true

  - name: "Level4"
    module: "Level4"
    parent: "Level"
    methods:
      - name: "generateBlock"
        return_type: "unique_ptr<Block>"
        visibility: "public"
        override: true

  # Observer Pattern Classes
  - name: "Observer"
    module: "Observer"
    abstract: true
    methods:
      - name: "notify"
        return_type: "void"
        visibility: "public"
        pure_virtual: true

  - name: "Subject"
    module: "Subject"
    abstract: true
    methods:
      - name: "attach"
        return_type: "void"
        parameters: ["Observer* o"]
        visibility: "public"
      - name: "detach"
        return_type: "void"
        parameters: ["Observer* o"]
        visibility: "public"
      - name: "notifyObservers"
        return_type: "void"
        visibility: "public"
    relationships:
      - type: "aggregation"
        target: "Observer"
        multiplicity: "*"

  - name: "TextDisplay"
    module: "TextDisplay"
    parent: "Observer"
    methods:
      - name: "notify"
        return_type: "void"
        visibility: "public"
        override: true
      - name: "display"
        return_type: "void"
        parameters: ["ostream& out"]
        visibility: "public"
      - name: "setHiScore"
        return_type: "void"
        parameters: ["int score"]
        visibility: "public"
      - name: "updateBoards"
        return_type: "void"
        parameters: ["Board* b1", "Board* b2"]
        visibility: "public"
    relationships:
      - type: "aggregation"
        target: "Board"
        multiplicity: "2"
      - type: "aggregation"
        target: "Player"
        multiplicity: "2"
      - type: "inheritance"
        target: "Observer"

  - name: "GraphicsDisplay"
    module: "GraphicsDisplay"
    parent: "Observer"
    methods:
      - name: "notify"
        return_type: "void"
        visibility: "public"
        override: true
      - name: "setHiScore"
        return_type: "void"
        parameters: ["int score"]
        visibility: "public"
      - name: "updateBoards"
        return_type: "void"
        parameters: ["Board* b1", "Board* b2"]
        visibility: "public"
    relationships:
      - type: "composition"
        target: "Xwindow"
        multiplicity: "1"
      - type: "aggregation"
        target: "Board"
        multiplicity: "2"
      - type: "aggregation"
        target: "Player"
        multiplicity: "2"
      - type: "inheritance"
        target: "Observer"

  - name: "Xwindow"
    module: "XWindow"
    methods:
      - name: "fillRectangle"
        return_type: "void"
        parameters: ["int x", "int y", "int width", "int height", "int colour=Black"]
        visibility: "public"
      - name: "drawString"
        return_type: "void"
        parameters: ["int x", "int y", "std::string msg"]
        visibility: "public"

  # Command Interpreter
  - name: "CommandInterpreter"
    module: "CommandInterpreter"
    methods:
      - name: "parse"
        return_type: "bool"
        parameters: ["const string& input", "Player* current", "Player* opponent"]
        visibility: "public"
      - name: "executeSequence"
        return_type: "void"
        parameters: ["const string& filename", "Player* current", "Player* opponent"]
        visibility: "public"
    relationships:
      - type: "dependency"
        target: "Player"

  # Special Action Classes
  - name: "SpecialAction"
    module: "SpecialAction"
    abstract: true
    methods:
      - name: "apply"
        return_type: "void"
        parameters: ["Player* player"]
        visibility: "public"
        pure_virtual: true
      - name: "getName"
        return_type: "string"
        visibility: "public"
        const: true
        pure_virtual: true
    relationships:
      - type: "dependency"
        target: "Player"

  - name: "BlindAction"
    module: "SpecialAction"
    parent: "SpecialAction"
    methods:
      - name: "apply"
        return_type: "void"
        parameters: ["Player* player"]
        visibility: "public"
        override: true
      - name: "getName"
        return_type: "string"
        visibility: "public"
        const: true
        override: true

  - name: "HeavyAction"
    module: "SpecialAction"
    parent: "SpecialAction"
    methods:
      - name: "apply"
        return_type: "void"
        parameters: ["Player* player"]
        visibility: "public"
        override: true
      - name: "getName"
        return_type: "string"
        visibility: "public"
        const: true
        override: true

  - name: "ForceAction"
    module: "SpecialAction"
    parent: "SpecialAction"
    methods:
      - name: "apply"
        return_type: "void"
        parameters: ["Player* player"]
        visibility: "public"
        override: true
      - name: "getName"
        return_type: "string"
        visibility: "public"
        const: true
        override: true

  # Utility Classes
  - name: "Cell"
    module: "Cell"
    methods:
      - name: "occupy"
        return_type: "void"
        parameters: ["Block* block"]
        visibility: "public"
      - name: "clear"
        return_type: "void"
        visibility: "public"
    relationships:
      - type: "aggregation"
        target: "Block"
        multiplicity: "0..1"

  - name: "Position"
    module: "Position"
    struct: true
    methods:
      - name: "operator=="
        return_type: "bool"
        parameters: ["const Position& other"]
        visibility: "public"
        const: true
      - name: "operator!="
        return_type: "bool"
        parameters: ["const Position& other"]
        visibility: "public"
        const: true

# Relationships Summary
relationships_summary:
  inheritance:
    - "Board extends Subject"
    - "TextDisplay extends Observer"
    - "GraphicsDisplay extends Observer"
    - "Block (abstract) - parent of IBlock, JBlock, LBlock, OBlock, SBlock, ZBlock, TBlock, StarBlock"
    - "Level (abstract) - parent of Level0, Level1, Level2, Level3, Level4"
    - "SpecialAction (abstract) - parent of BlindAction, HeavyAction, ForceAction"
  
  composition:
    - "Game contains 2 Player (unique_ptr)"
    - "Game contains 1 TextDisplay (unique_ptr)"
    - "Game contains 0..1 GraphicsDisplay (unique_ptr)"
    - "Game contains 1 CommandInterpreter (unique_ptr)"
    - "Player contains 1 Board (unique_ptr)"
    - "Player contains * Block (unique_ptr in allBlocks vector)"
    - "Player contains 1 Level (unique_ptr)"
    - "Board contains * Cell (unique_ptr in cells grid)"
    - "GraphicsDisplay contains 1 Xwindow (raw pointer)"
  
  aggregation:
    - "Board aggregates * Block (placedBlocks vector)"
    - "Block aggregates * Cell (cells vector)"
    - "Cell aggregates 0..1 Block (occupiedBy pointer)"
    - "Subject aggregates * Observer (observers vector)"
    - "TextDisplay aggregates 2 Board (board1, board2 pointers)"
    - "TextDisplay aggregates 2 Player (player1, player2 pointers)"
    - "GraphicsDisplay aggregates 2 Board (board1, board2 pointers)"
    - "GraphicsDisplay aggregates 2 Player (player1, player2 pointers)"
  
  dependency:
    - "Player depends on SpecialAction"
    - "Board depends on Position"
    - "Block depends on Position"
    - "Level depends on Block"
    - "CommandInterpreter depends on Player"

# Design Patterns Used
design_patterns:
  - name: "Observer Pattern"
    description: "Subject-Observer pattern for display updates"
    participants:
      - "Subject (abstract) - notifies observers of changes"
      - "Observer (abstract) - receives notifications"
      - "Board extends Subject - game board that notifies displays"
      - "TextDisplay extends Observer - text-based display"
      - "GraphicsDisplay extends Observer - graphical display"
  
  - name: "Strategy Pattern"
    description: "Level classes implement different block generation strategies"
    participants:
      - "Level (abstract strategy)"
      - "Level0, Level1, Level2, Level3, Level4 (concrete strategies)"
      - "Player (context that uses level strategy)"
  
  - name: "Template Method Pattern"
    description: "Block class defines template with getShapeCoordinates() hook"
    participants:
      - "Block (abstract template)"
      - "IBlock, JBlock, LBlock, OBlock, SBlock, ZBlock, TBlock, StarBlock (concrete implementations)"
  
  - name: "Command Pattern"
    description: "SpecialAction classes encapsulate actions"
    participants:
      - "SpecialAction (abstract command)"
      - "BlindAction, HeavyAction, ForceAction (concrete commands)"
      - "Player (receiver)"

# Notes
notes:
  - "All classes use C++20 modules (export module)"
  - "Memory management uses smart pointers (unique_ptr) for ownership"
  - "Raw pointers used for non-owning relationships (aggregation)"
  - "Board uses Observer pattern to notify displays of changes"
  - "Player owns all blocks through allBlocks vector"
  - "Board owns cells but blocks reference them (non-owning)"
  - "Game manages two players and coordinates gameplay"
  - "Only public methods shown (constructors, destructors, accessors, mutators excluded)"
